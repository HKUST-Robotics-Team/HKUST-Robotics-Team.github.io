var J=Object.defineProperty;var K=(e,t,r)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var j=(e,t,r)=>(K(e,typeof t!="symbol"?t+"":t,r),r);const Y=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}};Y();function d(e){const t=("0"+Math.floor(e%1e3/10)).slice(-2),r=("0"+Math.floor(e/1e3%60)).slice(-2);return`${("0"+Math.floor(e/60/1e3)).slice(-2)}:${r}.${t}`}function Q(e){const t=-e.getTimezoneOffset(),r=t>=0?"+":"-",n=function(s){const o=Math.floor(Math.abs(s));return(o<10?"0":"")+o};return e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())+r+n(t/60)+":"+n(t%60)}function W(e,t="result.json"){var r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(e))),r.setAttribute("download",t),r.click()}function X(e,t,r){const n={createdAt:Q(new Date),data:{red:{name:e.red,finalScore:t.red.final,greatVictory:t.red.greatVictory,win:t.red.win,records:r.red},blue:{name:e.blue,finalScore:t.blue.final,greatVictory:t.blue.greatVictory,win:t.blue.win,records:r.blue}}};W(n,"result.json")}const Z=new CustomEvent("greatVictory",{detail:{team:"red"}}),ee=new CustomEvent("greatVictory",{detail:{team:"blue"}}),C=class{constructor(t,r,n,s="+1"){this.time=d(t),this.team=r.split("-").slice(0,1),this.action=C.object_list[r]+" "+s,this.score=n.score,this.multi=n.multi}toHTML(){const t=document.createElement("div");return t.className="record flex py-2",t.innerHTML=`<span>${this.time}</span><span>${this.action}</span><span>${this.score} (x${this.multi})</span>`,t}toObj(){return{time:this.time,action:this.action,score:this.score,multi:this.multi}}};let R=C;j(R,"object_list",{"red-plate":"plate","red-pot-1":"pot 1","red-pot-2":"pot 2","red-smartcar":"smartcar","blue-plate":"plate","blue-pot-1":"pot 1","blue-pot-2":"pot 2","blue-smartcar":"smartcar"});function te(e){let t={red_pot:0,red_plate:0,red_smartcar:0,blue_pot:0,blue_plate:0,blue_smartcar:0};return Object.entries(e).forEach(([r,n])=>{const[s,o,...l]=r.split("-");if(s=="red")switch(o){case"pot":t.red_pot+=n;break;case"plate":t.red_plate+=n;break;case"smartcar":t.red_smartcar=n;break}else if(s=="blue")switch(o){case"pot":t.blue_pot+=n;break;case"plate":t.blue_plate+=n;break;case"smartcar":t.blue_smartcar=n;break}}),t}function D(e,t,r){const n=e%2*50+Math.floor(e/2)*200+t%2*75+Math.floor(t/2)*300,s=1+r*.01;return{score:n,mul:s}}function B(e,t=!1){const{red_pot:r,red_plate:n,red_smartcar:s,blue_pot:o,blue_plate:l,blue_smartcar:P}=te(e);let{score:b,mul:x}=D(r,n,s),{score:h,mul:q}=D(o,l,P);const A=r>=2&&n>=2,M=o>=2&&l>=2;return A&&document.dispatchEvent(Z),M&&document.dispatchEvent(ee),t?(b*=x,h*=q,{red:{score:b,multi:x,gv:A,win:b>h||A},blue:{score:h,multi:q,gv:M,win:h>b||M}}):{red:{score:b,multi:x},blue:{score:h,multi:q}}}class re{constructor(){this.isRunning=!1,this.startTime=0,this.overallTime=0}_getTimeElapsedSinceLastStart(){return this.startTime?Date.now()-this.startTime:0}start(){this.isRunning||(this.isRunning=!0,this.startTime=Date.now())}stop(){!this.isRunning||(this.isRunning=!1,this.overallTime=this.overallTime+this._getTimeElapsedSinceLastStart())}reset(){if(this.overallTime=0,this.isRunning){this.startTime=Date.now();return}this.startTime=0}getTime(){return this.startTime?this.isRunning?this.overallTime+this._getTimeElapsedSinceLastStart():this.overallTime:0}}var ne="/RDC2021/assets/countdown.d79f80a0.mp3",se="/RDC2021/assets/long_beeps.c5591596.mp3",oe="/RDC2021/assets/beeps.3e6219b9.mp3";const $=document.querySelectorAll(".counter"),a={},y={red:[],blue:[]},ie=["Alkali Metal","Now","Delta Three-ta","4gotton","Team Fire","Cancer","Group 7","Infinity","Cloud9"],k=document.querySelector("#start"),g=document.querySelector("#stop"),V=document.querySelector("#reset"),ae=document.querySelector("#save"),ce=document.querySelector("#load"),le=document.querySelector("#cal-final-score"),u=document.querySelector("#countdown-timer"),m=document.querySelector("#countup-timer"),I=document.querySelectorAll(".team-name"),c={red:document.querySelector("#red-scoreboard"),blue:document.querySelector("#blue-scoreboard"),redBig:document.querySelector("#red-score"),blueBig:document.querySelector("#blue-score")},T=new Audio;T.src=ne;T.preload="auto";T.volume=.5;const L=new Audio;L.src=se;L.preload="auto";L.volume=.5;const _=new Audio;_.src=oe;_.preload="auto";_.volume=.5;const v=1*60*1e3,N=3*60*1e3;let E=0,p=0;const f=new re;let O=null,S=!1;I.forEach(e=>{ie.forEach(t=>{const r=document.createElement("option");r.value=t,r.text=t,e.appendChild(r)})});$.forEach(e=>{a[e.id]=0,e.addEventListener("mousedown",t=>{const r=de(t,e.id);e.innerText=a[e.id];const n=B(a),s=e.id.split("-").slice(0,1),o=new R(f.getTime(),e.id,n[s],r);c[s].prepend(o.toHTML()),c[s+"Big"].innerText=n[s].score,y[s].push(o.toObj())})});function de(e,t){if(typeof e=="object")switch(e.button){case 0:return a[t]++,"+1";case 2:return a[t]--,"-1"}}function ue(){E=0,f.reset(),S=!1,p=v,u.innerText=d(v),m.innerText=d(0),m.classList.remove("times-up"),u.classList.remove("times-up"),y.red=[],y.blue=[],$.forEach(t=>{a[t.id]=0,t.innerText=a[t.id]}),c.red.innerHTML="",c.blue.innerHTML="",c.redBig.innerText="0",c.blueBig.innerText="0";const e=document.querySelector(".great-victory");e&&(e.outerHTML="",O=null)}function w(){f.stop(),clearInterval(E)}function F(){const e=f.getTime();if(e>=p-5200&&!S&&(S=!0,T.play()),e>=N){w(),g.click(),m.innerText=d(N),u.innerText=d(0),m.classList.add("times-up"),u.classList.add("times-up"),L.play();return}else p==v&&e>=v&&(S=!1,_.play(),w(),f.reset(),p=N,f.start(),E=setInterval(F,8));m.innerText=d(e),u.innerText=d(p-e)}k.addEventListener("click",()=>{k.disabled=!0,g.classList.remove("hidden"),V.classList.add("hidden"),u.disabled=!1,m.disabled=!1,p=v,f.start(),E=setInterval(F,8)});g.addEventListener("click",()=>{u.disabled=!0,m.disabled=!0,g.classList.add("hidden"),V.classList.remove("hidden"),w()});V.addEventListener("click",()=>{k.disabled=!1,ue()});ae.addEventListener("click",()=>{const e=B(a,!0);X({red:I[1].value,blue:I[0].value},{red:{final:e.red.score,greatVictory:e.red.gv,win:e.red.win},blue:{final:e.blue.score,greatVictory:e.blue.gv,win:e.blue.win}},y)});le.addEventListener("click",()=>{const e=B(a,!0);c.blueBig.innerText=+e.blue.score.toFixed(1),c.redBig.innerText=+e.red.score.toFixed(1)});ce.addEventListener("click",()=>{document.querySelector(".drop-area").classList.toggle("hidden")});document.addEventListener("greatVictory",e=>{if(!O){w(),g.click();const t=document.createElement("div");t.classList.add("great-victory");const r=document.createElement("h1");r.innerText="Great Victory",r.classList.add("text-size-3xl","font-bold"),t.appendChild(r);const n=c[e.detail.team+"Big"];n.parentNode.insertBefore(t,n.nextSibling),O=t}});const i=document.querySelector(".drop-area"),H=document.querySelector("#file-name"),G={red:document.querySelector("#red-scoreboard"),blue:document.querySelector("#blue-scoreboard"),redBig:document.querySelector("#red-score"),blueBig:document.querySelector("#blue-score")},U=document.querySelectorAll(".team-name"),z=new FileReader;["dragenter","dragover","dragleave","drop"].forEach(e=>{i.addEventListener(e,t=>{t.preventDefault(),t.stopPropagation()},!1)});["dragenter","dragover"].forEach(e=>{i.addEventListener(e,t=>{i.classList.add("drop-highlight")},!1)});["dragleave","dropover"].forEach(e=>{i.addEventListener(e,t=>{i.classList.remove("drop-highlight")},!1)});i.addEventListener("drop",e=>{const t=e.dataTransfer.files;handleFile(t)},!1);window.handleFile=function(e){[...e].forEach(t=>{H.innerText=t.name,z.readAsText(t)})};z.onload=e=>{const t=JSON.parse(e.target.result);i.classList.add("drop-success"),setTimeout(()=>{i.classList.add("hidden"),i.classList.remove("drop-success"),i.classList.remove("drop-highlight"),H.innerText="",me(t.data)},300)};function me(e){Object.entries(e).forEach(([t,r])=>{if(G[t+"Big"].innerText=r.finalScore,r.greatVictory){const n=document.createElement("div");n.classList.add("great-victory");const s=document.createElement("h1");s.innerText="Great Victory",s.classList.add("text-size-3xl","font-bold"),n.appendChild(s);const o=G[t+"Big"];o.parentNode.insertBefore(n,o.nextSibling)}t+""=="red"?U[0].value=r.name:t+""=="blue"&&(U[1].value=r.name)})}
