var J=Object.defineProperty;var K=(e,t,r)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var H=(e,t,r)=>(K(e,typeof t!="symbol"?t+"":t,r),r);const Y=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}};Y();function d(e){const t=("0"+Math.floor(e%1e3/10)).slice(-2),r=("0"+Math.floor(e/1e3%60)).slice(-2);return`${("0"+Math.floor(e/60/1e3)).slice(-2)}:${r}.${t}`}function Q(e){const t=-e.getTimezoneOffset(),r=t>=0?"+":"-",o=function(n){const s=Math.floor(Math.abs(n));return(s<10?"0":"")+s};return e.getFullYear()+"-"+o(e.getMonth()+1)+"-"+o(e.getDate())+"T"+o(e.getHours())+":"+o(e.getMinutes())+":"+o(e.getSeconds())+r+o(t/60)+":"+o(t%60)}function W(e,t="result.json"){var r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(e))),r.setAttribute("download",t),r.click()}function X(e,t,r){const o={createdAt:Q(new Date),data:{red:{name:e.red,finalScore:t.red.final,greatVictory:t.red.greatVictory,win:t.red.win,records:r.red},blue:{name:e.blue,finalScore:t.blue.final,greatVictory:t.blue.greatVictory,win:t.blue.win,records:r.blue}}};W(o,"result.json")}const Z=new CustomEvent("greatVictory",{detail:{team:"red"}}),ee=new CustomEvent("greatVictory",{detail:{team:"blue"}}),D=class{constructor(t,r,o,n="+1"){this.time=typeof t=="number"?d(t):t,this.team=r.split("-").slice(0,1),this.action=D.object_list[r]+" "+n,this.score=o.score,this.multi=o.multi}toHTML(){const t=document.createElement("div");return t.className="record flex py-2",t.innerHTML=`<span>${this.time}</span><span>${this.action}</span><span>${this.score} (x${this.multi})</span>`,t}toObj(){return{time:this.time,action:this.action,score:this.score,multi:this.multi}}};let y=D;H(y,"object_list",{"red-plate":"plate","red-pot-1":"pot 1","red-pot-2":"pot 2","red-smartcar":"smartcar","blue-plate":"plate","blue-pot-1":"pot 1","blue-pot-2":"pot 2","blue-smartcar":"smartcar"});function te(e){let t={red_pot:0,red_plate:0,red_smartcar:0,blue_pot:0,blue_plate:0,blue_smartcar:0};return Object.entries(e).forEach(([r,o])=>{const[n,s,...i]=r.split("-");if(n=="red")switch(s){case"pot":t.red_pot+=o;break;case"plate":t.red_plate+=o;break;case"smartcar":t.red_smartcar=o;break}else if(n=="blue")switch(s){case"pot":t.blue_pot+=o;break;case"plate":t.blue_plate+=o;break;case"smartcar":t.blue_smartcar=o;break}}),t}function $(e,t,r){const o=e%2*50+Math.floor(e/2)*200+t%2*75+Math.floor(t/2)*300,n=1+r*.01;return{score:o,mul:n}}function k(e,t=!1){const{red_pot:r,red_plate:o,red_smartcar:n,blue_pot:s,blue_plate:i,blue_smartcar:q}=te(e);let{score:b,mul:A}=$(r,o,n),{score:h,mul:M}=$(s,i,q);const B=e["red-pot-1"]>=1&&e["red-pot-2"]>=1&&o>=2,R=e["blue-pot-1"]>=1&&e["blue-pot-2"]>=1&&i>=2;return B&&document.dispatchEvent(Z),R&&document.dispatchEvent(ee),t?(b*=A,h*=M,{red:{score:b,multi:A,gv:B,win:b>h||B},blue:{score:h,multi:M,gv:R,win:h>b||R}}):{red:{score:b,multi:A},blue:{score:h,multi:M}}}class re{constructor(){this.isRunning=!1,this.startTime=0,this.overallTime=0}_getTimeElapsedSinceLastStart(){return this.startTime?Date.now()-this.startTime:0}start(){this.isRunning||(this.isRunning=!0,this.startTime=Date.now())}stop(){!this.isRunning||(this.isRunning=!1,this.overallTime=this.overallTime+this._getTimeElapsedSinceLastStart())}reset(){if(this.overallTime=0,this.isRunning){this.startTime=Date.now();return}this.startTime=0}getTime(){return this.startTime?this.isRunning?this.overallTime+this._getTimeElapsedSinceLastStart():this.overallTime:0}}var ne="/RDC2021/assets/countdown.d79f80a0.mp3",oe="/RDC2021/assets/long_beeps.c5591596.mp3",se="/RDC2021/assets/beeps.3e6219b9.mp3";const F=document.querySelectorAll(".counter"),a={},T={red:[],blue:[]},ie=["Alkali Metal","Now","Delta Three-ta","4gotton","Team Fire","Cancer","Group 7","Infinity","Cloud9"],I=document.querySelector("#start"),g=document.querySelector("#stop"),O=document.querySelector("#reset"),ce=document.querySelector("#save"),ae=document.querySelector("#load"),le=document.querySelector("#cal-final-score"),u=document.querySelector("#countdown-timer"),m=document.querySelector("#countup-timer"),V=document.querySelectorAll(".team-name"),l={red:document.querySelector("#red-scoreboard"),blue:document.querySelector("#blue-scoreboard"),redBig:document.querySelector("#red-score"),blueBig:document.querySelector("#blue-score")},L=new Audio;L.src=ne;L.preload="auto";L.volume=.5;const E=new Audio;E.src=oe;E.preload="auto";E.volume=.5;const S=new Audio;S.src=se;S.preload="auto";S.volume=.5;const v=1*60*1e3,N=3*60*1e3;let _=0,f=0;const p=new re;let j=null,w=!1;V.forEach(e=>{ie.forEach(t=>{const r=document.createElement("option");r.value=t,r.text=t,e.appendChild(r)})});F.forEach(e=>{a[e.id]=0,e.addEventListener("mousedown",t=>{const r=de(t,e.id);e.innerText=a[e.id];const o=k(a),n=e.id.split("-").slice(0,1),s=new y(p.getTime(),e.id,o[n],r);l[n].prepend(s.toHTML()),l[n+"Big"].innerText=o[n].score,T[n].push(s.toObj())})});function de(e,t){if(typeof e=="object")switch(e.button){case 0:return a[t]++,"+1";case 2:return a[t]--,"-1"}}function ue(){_=0,p.reset(),w=!1,f=v,u.innerText=d(v),m.innerText=d(0),m.classList.remove("times-up"),u.classList.remove("times-up"),T.red=[],T.blue=[],F.forEach(t=>{a[t.id]=0,t.innerText=a[t.id]}),l.red.innerHTML="",l.blue.innerHTML="",l.redBig.innerText="0",l.blueBig.innerText="0";const e=document.querySelector(".great-victory");e&&(e.outerHTML="",j=null)}function x(){p.stop(),clearInterval(_)}function G(){const e=p.getTime();if(e>=f-5200&&!w&&(w=!0,L.play()),e>=N){x(),g.click(),m.innerText=d(N),u.innerText=d(0),m.classList.add("times-up"),u.classList.add("times-up"),E.play();return}else f==v&&e>=v&&(w=!1,S.play(),x(),p.reset(),f=N,p.start(),_=setInterval(G,8));m.innerText=d(e),u.innerText=d(f-e)}I.addEventListener("click",()=>{I.disabled=!0,g.classList.remove("hidden"),O.classList.add("hidden"),u.disabled=!1,m.disabled=!1,f=v,p.start(),_=setInterval(G,8)});g.addEventListener("click",()=>{u.disabled=!0,m.disabled=!0,g.classList.add("hidden"),O.classList.remove("hidden"),x()});O.addEventListener("click",()=>{I.disabled=!1,ue()});ce.addEventListener("click",()=>{const e=k(a,!0);X({red:V[1].value,blue:V[0].value},{red:{final:e.red.score,greatVictory:e.red.gv,win:e.red.win},blue:{final:e.blue.score,greatVictory:e.blue.gv,win:e.blue.win}},T)});le.addEventListener("click",()=>{const e=k(a,!0);l.blueBig.innerText=+e.blue.score.toFixed(1),l.redBig.innerText=+e.red.score.toFixed(1)});ae.addEventListener("click",()=>{document.querySelector(".drop-area").classList.toggle("hidden")});document.addEventListener("greatVictory",e=>{if(!j){x(),g.click();const t=document.createElement("div");t.classList.add("great-victory");const r=document.createElement("h1");r.innerText="Great Victory",r.classList.add("text-size-3xl","font-bold"),t.appendChild(r);const o=l[e.detail.team+"Big"];o.parentNode.insertBefore(t,o.nextSibling),j=t}});const c=document.querySelector(".drop-area"),U=document.querySelector("#file-name"),C={red:document.querySelector("#red-scoreboard"),blue:document.querySelector("#blue-scoreboard"),redBig:document.querySelector("#red-score"),blueBig:document.querySelector("#blue-score")},z=document.querySelectorAll(".team-name"),P=new FileReader;["dragenter","dragover","dragleave","drop"].forEach(e=>{c.addEventListener(e,t=>{t.preventDefault(),t.stopPropagation()},!1)});["dragenter","dragover"].forEach(e=>{c.addEventListener(e,t=>{c.classList.add("drop-highlight")},!1)});["dragleave","dropover"].forEach(e=>{c.addEventListener(e,t=>{c.classList.remove("drop-highlight")},!1)});c.addEventListener("drop",e=>{const t=e.dataTransfer.files;handleFile(t)},!1);window.handleFile=function(e){[...e].forEach(t=>{U.innerText=t.name,P.readAsText(t)})};P.onload=e=>{const t=JSON.parse(e.target.result);c.classList.add("drop-success"),setTimeout(()=>{c.classList.add("hidden"),c.classList.remove("drop-success"),c.classList.remove("drop-highlight"),U.innerText="",me(t.data)},300)};function me(e){Object.entries(e).forEach(([t,r])=>{if(C[t+"Big"].innerText=r.finalScore,r.greatVictory){const n=document.createElement("div");n.classList.add("great-victory");const s=document.createElement("h1");s.innerText="Great Victory",s.classList.add("text-size-3xl","font-bold"),n.appendChild(s);const i=C[t+"Big"];i.parentNode.insertBefore(n,i.nextSibling)}t+""=="red"?z[0].value=r.name:t+""=="blue"&&(z[1].value=r.name);const o={};r.records.forEach(n=>{const s=n.action.split(" "),i=[t+"",...s.slice(0,-1)].join("-");console.log(i),o[i]?o[i]++:o[i]=1;const q=new y(n.time,i,{score:n.score,multi:n.multi},s.slice(-1));C[t].appendChild(q.toHTML())}),Object.entries(o).forEach(([n,s])=>{document.getElementById(n).innerText=s})})}
